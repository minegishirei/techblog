




Kubernetesにおけるセキュリティ、アクセス制御うの仕組みについて解説します。



## アクセス制御はなぜ必要なのか?

スタートアップ企業や、エンジニアリング組織の立ち上げ期では、数名の社員から始まることが多く、権限管理についても比較的緩やかな管理になります。
Kubernetesで実行されるアプリケーションは、通常パーミッションは設定されていません。
特に指定しない限り、すべてのPodはそれらによって作成されるNamespaceの`defaultサービスアカウント`として実行され、いかなるロールも関連づけられません。


しかし、組織が成長するとシステムの規模も人員も拡大し、誰かがミスを犯しただけでやってはいけない変更が発生する可能性があります。

Kubernetesでは、ロールベースのアクセス管理が可能であるため、ユーザーごとにロールを設定することができます。


## クラスタ別のアクセス管理

Kubernetesクラスタのセキュリティを確保するために実施できる最も簡単な方法は、クラスタにアクセスできるユーザーを制限することです。
加えて、アクセスできるユーザーを`クラスタ運用者`と`アプリケーション開発者`の2種類があります。

このようにすることで、チームごとにクラスタを用意すれば、別のチームが望ましくない変更を加えることを防ぐことができます。


## ロールベースのアクセス制御(RBACの導入)

Kubernetesが備えるロールベースのアクセス制御システムを使うことで、クラスタ内の操作を誰が実行できるか制御できます。

このロールベースのアクセス制御システムを**Role-Based Access Control**と呼びます。

RBACでは特定のパーミッションを特定のユーザーに与えることで、システムの読み取りから書き込みをできるようにします。
例えば、クラスタ内のPodを一覧表示する権限を基本的なユーザーに与えることで、Podの全てが確認できるようになります。



## RBACが有効になっているかどうかの確認


RBACクラスタが有効になっているかどうかを確認するには、次のコマンドを実行してみてください。

```sh
kubectl describe pod -n kube-system -l component=kube-apiserver
```

上記のコマンド結果で、`--authorization-mode`に`RBAC`が含まれていなければ、クラスタでは`RBAC`が有効になっていません。



## ロールの理解

Kubernetesの**ロール**は許可を出すパーミッションのセットのことです。
ロールをカスタマイズしたものを作ることが可能ですが、Kubernetesには、初めから使える定義ずみのロールがいくつか用意されています。
(`view`ロールは与えられた`namespace`に含まれるオブジェクトを閲覧可能ですが、変更権限はありません。)

ロールは`Namespace`のレベルか、`Cluster`の範囲で適応することができます。





























































































