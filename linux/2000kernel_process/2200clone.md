

例えば、ユーザーのコマンド入力のたびにシェルはシェルの複製を実行する新しいプロセスを生成します。

伝統的なUnixではすべてのプロセスが同じように扱われますが、これは効率が悪いです、。（親プロセスが所有する資源は複製され、子プロセスに渡される方法。多くの場合、すぐに`execve()`を発行して複製したアドレス空間を捨ててしまいます。

そこで、Linuxカーネルは次のように対応します。

1. コピー音ライト手法により、親プロセスおよび子プロセスの両方が同一の物理ページを読むことができます。（片方がその物理ページの変更を行おうとするときに複製する方法です）
2. 軽量プロセスにより親プロセスと子プロセスは、データ構造を共有しています。
3. `vfork()`システムコールは親プロセスとメモリ空間を共有するプロセスを生成します。子プロセスが実行を終了、もしくは新しいプログラムが実行を開始するまで、親プロセスの実行は止められます。


### clone()システムコール

from https://kazmax.zpp.jp/cmd/c/clone.2.html

**clone ()の主要な使用法はスレッド (threads) を実装することである**: 一つのプログラムの中の複数のスレッドは共有されたメモリ空間で 同時に実行される。
clone ()で子プロセスが作成された時に、作成された子プロセスは関数 fn ( arg )を実行する。

以下はcloneの引数一覧です

- `fn`生成するプロセスが実行する関数
- `arg`:fn()関数に渡す引数へのポインタ
- `flags`:グローバル定数と連携し、様々な情報を表す。

### flagsのオプション一覧

flagsはグローバル定数と連携し、様々な情報を表す。
以下がそのグローバル定数です。


















