


## 覚えるべきレジスタ

大量にレジスタが出てきたのでこの辺でどんなレジスタがあるかを一覧にする。

- rax:関数の戻り値
- rdi:関数の第一引数
- rip:次に実行する命令のアドレス
- rbp:スタックのベースのポインタ（要注意！）
- rsp:スタックのトップのポインタ（要注意！）


## スタックとは?

先ほど話した`rbp`レジスタと`rsp`レジスタがスタックそのものを表している。

- rはレジスタの略
- pはポインタの略
    - rbpのbはベースの略で、スタックの底を表す。
    新しいスタック領域が始まるたびにプログラムがセットする必要がある。
    - rspのsはスタックの略で、スタックのてっぺんを表す。
    popやpushのたびにポインタの値は変わる。

rspについて。

### push

レジスタの`rsp`を８バイト減らす。

```asm
sub rsp 0x8 (結果はraxに格納される)
mov [rsp] rax
```

`[`はc言語でいうところのポインタ参照。`[rsp]`と書くことで値を直接編集できる。
このようにして、アセンブラは現在参照しているポインタである`rsp`を増減しながら処理を先に進めることができる。


### pop

逆にpopはレジスタ`rsp`から8バイト増加させている。

```asm
add rsp 0x8
mov [rsp] rax
```


## スタックの使い方

先ほどの`rsp`に対する`push`と`pop`は関数呼び出しにつかわれる。
アセンブリでは関数を呼び出す`call`と実行結果を返す`ret`で構成されているが、それらの中身では`rsp`に対する`pop`と`push`が動いている


### callとretの挙動

`call`は
- 次の行のアドレスをスタックにpushする
- その後、callの引数にjumpする

という処理を行う。

その後、`ret`は
- `rip`に`pop`を行うことで、呼び出し元のアドレスを手に入れる
- アドレス先にjumpする






